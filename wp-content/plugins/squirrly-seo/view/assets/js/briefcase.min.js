if(typeof SQ_DEBUG==="undefined")var SQ_DEBUG=false;(function($){"use strict";var briefcaseTable;var briefcaseLabelTable;var suggestTable;$.fn.sq_Briefcase=function(){var $this=this;var $popupAddKeyword=$this.find(".sq_add_keyword_dialog");var $popupAddLabel=$this.find(".sq_add_labels_dialog");var $popupEditLabel=$this.find(".sq_edit_label_dialog");$this.listenAdd=function(){$popupAddLabel.find("#sq_labelcolor").wpColorPicker();$popupAddLabel.find("#sq_save_label").on("click",function(){var $button=$(this);var $name=$popupAddLabel.find("input#sq_labelname").val();var $color=$popupAddLabel.find("input#sq_labelcolor").val();$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:"sq_briefcase_addlabel",name:$name,color:$color,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.saved!=="undefined"){location.reload();$button.removeClass("sq_minloading")}else if(typeof response.error!=="undefined"){$button.removeClass("sq_minloading");$.sq_showMessage(response.error).addClass("sq_error")}}).fail(function(){$button.removeClass("sq_minloading")},"json")});$this.find(".sq_save_keyword_labels").on("click",function(){var $popup=$(this).parents(".sq_label_manage_popup:last");var $button=$(this);var $keyword=$(this).data("keyword");var $labels=[];$popup.find('input[name="sq_labels"]:checked').each(function(){$labels.push(this.value)});$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:"sq_briefcase_keywordlabel",keyword:$keyword,labels:$labels,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.saved!=="undefined"){location.reload();$button.removeClass("sq_minloading")}else if(typeof response.error!=="undefined"){$button.removeClass("sq_minloading");$.sq_showMessage(response.error).addClass("sq_error")}}).fail(function(){$button.removeClass("sq_minloading")},"json")})};$this.listenEdit=function(){$popupEditLabel.find("#sq_labelcolor").wpColorPicker();$this.find(".sq_edit_label").on("click",function(){$("#element .wp-picker-clear").trigger("click");$popupEditLabel.find("input#sq_labelid").val($(this).attr("data-id"));$popupEditLabel.find("input#sq_labelname").val($(this).attr("data-name"));$popupEditLabel.find("input#sq_labelcolor").val($(this).attr("data-color"));$popupEditLabel.find("input#sq_labelcolor").trigger("change");$popupAddKeyword.modal("hide");$popupAddLabel.modal("hide");$popupEditLabel.modal("show")});$popupEditLabel.find("#sq_save_label").on("click",function(){var $button=$(this);var $id=$popupEditLabel.find("#sq_labelid").val();var $name=$popupEditLabel.find("#sq_labelname").val();var $color=$popupEditLabel.find("#sq_labelcolor").val();$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:"sq_briefcase_editlabel",id:$id,name:$name,color:$color,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.saved!=="undefined"){location.reload();$button.removeClass("sq_minloading")}else if(typeof response.error!=="undefined"){$button.removeClass("sq_minloading");$.sq_showMessage(response.error).addClass("sq_error")}}).fail(function(){$button.removeClass("sq_minloading")},"json")})};$this.listenDelete=function(){$this.find(".sq_delete").on("click",function(){if(confirm("Are you sure ?")){var $button=$(this);var $keyword=$(this).data("keyword");var $id=$(this).data("id");$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:"sq_briefcase_deletekeyword",keyword:$keyword,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$this.find("#sq_row_"+$id).remove();$this.find("#sq_subrow_"+$id).remove()}else if(typeof response.error!=="undefined"){$.sq_showMessage(response.error).addClass("sq_error")}$button.removeClass("sq_minloading")}).fail(function(){$button.removeClass("sq_minloading")},"json")}});$this.find(".sq_delete_label").on("click",function(){if(confirm("Are you sure ?")){var $button=$(this).parents(".sq_saved_label:last");var $id=$(this).data("id");$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:"sq_briefcase_deletelabel",id:$id,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.deleted!=="undefined"){location.reload();$button.remove();$this.find("label[data-id="+$id+"]").remove();$this.find(".sq_circle_label[data-id="+$id+"]").remove()}else if(typeof response.error!=="undefined"){$.sq_showMessage(response.error).addClass("sq_error")}$button.removeClass("sq_minloading")}).fail(function(){$button.removeClass("sq_minloading")},"json")}});$this.find(".sq_delete_found").on("click",function(){if(confirm("Are you sure ?")){var $button=$(this);var $keyword=$(this).data("keyword");var $id=$(this).data("id");$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:"sq_briefcase_deletefound",keyword:$keyword,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$this.find("#sq_row_"+$id).remove();$this.find("#sq_subrow_"+$id).remove()}else if(typeof response.error!=="undefined"){$.sq_showMessage(response.error).addClass("sq_error")}$button.removeClass("sq_minloading")}).fail(function(){$button.removeClass("sq_minloading")},"json")}})};$this.listenDoSerp=function(){$this.find(".sq_research_doserp").on("click",function(){var $button=$(this);var $keyword=$(this).data("keyword");var $success=$(this).data("success");var $link=$(this).data("link");$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:"sq_ajax_briefcase_doserp",keyword:$keyword,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$.sq_showMessage(response.message).addClass("sq_success");$button.html('<a href="'+$link+'">'+$success+"</a>");$button.off("click")}else if(typeof response.error!=="undefined"){$.sq_showMessage(response.error)}$button.removeClass("sq_minloading")}).fail(function(){$button.removeClass("sq_minloading")},"json")})};$this.listenOptions=function(){$("#sq_briefcase .sq_filter_label input[type=checkbox]").click(function(){$("#sq_briefcase .sq_filter_label input[type=checkbox]").each(function(){if(!$(this).is(":checked")){$(this).next("label").removeClass("sq_active")}});if($(this).is(":checked")){$(this).next("label").addClass("sq_active")}});$("#sq_briefcase .sq_add_keyword_dialog input[type=checkbox]").click(function(){$("#sq_briefcase .sq_add_keyword_dialog input[type=checkbox]").each(function(){if(!$(this).is(":checked")){$(this).next("label").removeClass("sq_active")}});if($(this).is(":checked")){$(this).next("label").addClass("sq_active")}});$("#sq_briefcase .sq_label_manage_popup input[type=checkbox]").click(function(){var $popup=$(this).parents(".sq_label_manage_popup:last");$popup.find("input[type=checkbox]").each(function(){if(!$(this).is(":checked")){$(this).next("label").removeClass("sq_active")}});if($(this).is(":checked")){$(this).next("label").addClass("sq_active")}})};$this.bulkAction=function(){$this.find(".sq_bulk_select_input").on("click",function(){if(!$(this).is(":checked")){$this.find(".sq_bulk_input").prop("checked",false)}else{$this.find(".sq_bulk_input").prop("checked",true)}});$this.find(".sq_bulk_submit").on("click",function(){var $button=$(this);if($this.find(".sq_bulk_action").find(":selected").val()!==""){if(!$button.hasClass("btn-modal")&&$this.find(".sq_bulk_action").find(":selected").val()==="sq_ajax_briefcase_bulk_label"){$this.find("#sq_label_manage_popup_bulk").modal("show");return}if($this.find(".sq_bulk_action").find(":selected").data("confirm")){if(!confirm($this.find(".sq_bulk_action").find(":selected").data("confirm"))){return}}var $sq_bulk_input=[];jQuery($this.find(".sq_bulk_input").serializeArray()).each(function(){$sq_bulk_input.push($(this).attr("value"))});var $sq_bulk_labels=[];jQuery($this.find(".sq_bulk_labels").serializeArray()).each(function(){$sq_bulk_labels.push($(this).attr("value"))});$button.addClass("sq_minloading");$.post(sqQuery.ajaxurl,{action:$this.find(".sq_bulk_action").find(":selected").val(),inputs:$sq_bulk_input,labels:$sq_bulk_labels,sq_nonce:sqQuery.nonce}).done(function(response){if(typeof response.message!=="undefined"){$.sq_showMessage(response.message).addClass("sq_success");if($this.find(".sq_bulk_action").find(":selected").val()==="sq_ajax_briefcase_bulk_doserp"){$this.find(".sq_bulk_input").each(function(){if($(this).is(":checked")){$(this).parents("tr:last").find(".sq_research_doserp").remove();$(this).prop("checked",false)}})}else if($this.find(".sq_bulk_action").find(":selected").val()==="sq_ajax_briefcase_bulk_delete"){$this.find(".sq_bulk_input").each(function(){if($(this).is(":checked")){briefcaseTable.row($(this).parents("tr:last")).remove().draw()}})}else{location.reload()}}else if(typeof response.error!=="undefined"){$.sq_showMessage(response.error)}$button.removeClass("sq_minloading")}).fail(function(){$button.removeClass("sq_minloading")},"json")}})};$("#dataTables tbody tr").on("click","td",function(event){});$this.listenAdd();$this.listenEdit();$this.listenDelete();$this.listenDoSerp();$this.listenOptions();$this.bulkAction();return $this};$.fn.loadTable=function(){$.extend($.fn.dataTableExt.oSort,{"formatted-posts-pre":function(a){return parseInt($("<div></div>").append(a).find("span").data("value"))},"formatted-posts-asc":function(a,b){return a-b},"formatted-posts-desc":function(a,b){return b-a},"formatted-value-pre":function(a){return $("<div></div>").append(a).find("span").data("value")},"formatted-value-asc":function(a,b){return a-b},"formatted-value-desc":function(a,b){return b-a},"formatted-progress-pre":function(a){return $("<div></div>").append(a).find("button").data("value")},"formatted-progress-asc":function(a,b){return a-b},"formatted-progress-desc":function(a,b){return b-a},"formatted-num-pre":function(a){return parseInt(a.replace(/[^\d\-\.]/g,""))},"formatted-num-asc":function(a,b){return a-b},"formatted-num-desc":function(a,b){return b-a},"formatted-rank-pre":function(a){var div=$("<div>"+a+"</div>");if(div.find("button").length){return parseInt(div.find("button").data("value"))}if(div.find("a").length){return parseInt(div.find("a").data("value"))}return parseInt(div.data("value"))},"formatted-rank-asc":function(a,b){return a-b},"formatted-rank-desc":function(a,b){return b-a}});return $(this).DataTable({columnDefs:[{targets:1,width:"40%"},{targets:2,sortable:true,type:"formatted-posts",width:"15%"},{targets:3,sortable:true,type:"formatted-rank",width:"20%"},{targets:4,sortable:true,type:"formatted-value",width:"15%"},{targets:5,sortable:true,type:"formatted-progress",width:"10%"},{targets:[0,6],sortable:false,width:"10px"}],bPaginate:true,bLengthChange:false,bFilter:false,iDisplayLength:10,aaSorting:[3,"asc",2,"desc"]})};$.fn.loadLabelTable=function(){return $(this).DataTable({columnDefs:[{targets:[1],searchable:true,sortable:true},{targets:[0,2,3],sortable:false}],bPaginate:true,bLengthChange:false,bFilter:false,iDisplayLength:10,aaSorting:[1,"desc"],fixedColumns:true})};$.fn.loadSuggestTable=function(){$.extend($.fn.dataTableExt.oSort,{"formatted-value-pre":function(a){return $("<div></div>").append(a).find("span").data("value")},"formatted-value-asc":function(a,b){return a-b},"formatted-value-desc":function(a,b){return b-a}});$(this).DataTable({columnDefs:[{targets:[5,6],sortable:false},{targets:[2,3,4],sortable:true,type:"formatted-value"}],bPaginate:false,bLengthChange:false,bFilter:true,iDisplayLength:50,fixedColumns:true})};$(document).ready(function(){$("#sq_briefcase").sq_Briefcase();$("#sq_briefcaselabels").sq_Briefcase();$("#sq_suggested").sq_Briefcase();briefcaseTable=$("#sq_briefcase table.table").loadTable();briefcaseLabelTable=$("#sq_briefcaselabels table.table").loadLabelTable();suggestTable=$("#sq_suggested table.table").loadSuggestTable()})})(jQuery);